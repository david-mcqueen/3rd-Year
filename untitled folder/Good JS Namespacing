registerNS("WebApplications.Trav.DetailsBlockDisplayAndAudit");

WebApplications.Trav.DetailsBlockDisplayAndAudit = (function () {

    var methods;

    methods = {
        display: function (displayInfo) {
            
            if (displayInfo.moduleID == 7 || displayInfo.moduleID == 8) {
                displayInfo.moduleID = 6;
            }

            if (displayInfo.detailsType == 24302) {//If the type is URL, Open a new window and navigate to the provided URL
                window.open(displayInfo.detailsValue);
                
            } else if (displayInfo.detailsType == 24304) {//If the type is Network
                
                try {
                    if ((displayInfo.detailsValue.indexOf('\\') === -1) && (displayInfo.detailsValue.indexOf('//') === -1)) {
                        //If the network path is a plain string, append a \ to the start.
                        displayInfo.detailsValue = '\\' + displayInfo.detailsValue;
                    }
                    window.open('file:///' + displayInfo.detailsValue);
                }
                catch (e) {
                    //Intentionally left this blank, as an error message is generated by the window.open method.
                }
               

            } else if (displayInfo.detailsType == "Errata") { //If the type is Errata
                WebApplications.Trav.DetailsBlockDisplayAndAudit.errata(displayInfo);
            }
            else {
                WebApplications.Trav.Viewer.ViewArticle(false,
                                                        true,
                                                        displayInfo.name,
                                                        function () {
                                                            WebApplications.Trav.BookingSummary.DetailBlock.Load(displayInfo.detailsID, displayInfo.bookingID, displayInfo.moduleID, displayInfo.tourID);
                                                        },
                                                        1000);
            }
            

            WebApplications.Trav.DetailsBlockDisplayAndAudit.auditDetails(displayInfo);
        },

        errata: function (displayInfo) {
            displayInfo.name = "Errata";
            WebApplications.Trav.Viewer.ViewArticle(false,
                                                    true,
                                                    "Errata",
                                                    function () {
                                                        WebApplications.Trav.BookingSummary.DetailBlock.LoadErrata(displayInfo.tourID);
                                                    });
            
            WebApplications.Trav.DetailsBlockDisplayAndAudit.auditDetails(displayInfo);
        },

        auditDetails: function (displayInfo) {
            //Change the module back to the correct value
            if (displayInfo.moduleID == 7 || displayInfo.moduleID == 8) {
                displayInfo.moduleID = 6;
            }
            
            WebApplications.Trav.AJAX.SendControllerActionRequest("Booking",
                                    "AuditDetailsBlock",
                                    {
                                        user: displayInfo.userID,
                                        module: displayInfo.moduleID,
                                        name: displayInfo.name,
                                        tourID: displayInfo.tourID,
                                        bookingID: displayInfo.bookingID,
                                        pathFollowed: displayInfo.pathFollowed,
                                        detailsID: displayInfo.detailsID
                                    },
                                    $.noop,
                                    $.noop
            );
        }
    };

    return {
        display: methods.display,
        errata: methods.errata,
        auditDetails: methods.auditDetails
    };

}());